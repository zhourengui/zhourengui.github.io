<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Buffer（缓冲区） | LittleBoy-前端爱好者</title>
<meta name="description" content="一位前端爱好者的大前端养成记" />
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/styles/main.css">

<script src="/media/js/jquery.min.js"></script>
<script src="/media/js/masonry.pkgd.min.js"></script>
<script src="/media/js/aos.js"></script>
<script src="/media/js/pace.min.js"></script>
<script src="/media/js/view-image.min.js"></script>
<script src="/media/js/jquery.magnific-popup.min.js"></script>
<script src="/media/js/functions.js"></script>
    <meta name="referrer" content="never">
    <meta name="description" content="前言：
JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。
但在处理像TCP流或文件流时，必须使用到二进制数据。因此在NodeJS中，定义了一个Buffer类，该类用来创建一个专门存放二进制数据的缓存区。
在NodeJS..." />
    <meta name="keywords" content="" />
    <script src="/media/js/waterfall.min.js"></script>
    <script src="/media/js/prism.min.js"></script>
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href=""><img src="/media/images/custom-headerLogo.png" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="" class="menu">首页</a></li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      归档
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/tags" class="menu">
                      标签
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1601367153989" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="搜点啥..." aria-label="搜点啥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('/media/images/gridea.jpg');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="2020-09-17"><i class="fa fa-calendar"></i><span class="lately">12 天前</span></time>
              
              <a href="/bufferhuan-chong-qu#comments" class="comments meta-info" title="">
                <i class="fa fa-comment remixicon"></i><span class="comment-count valine-comment-count" data-xid="/bufferhuan-chong-qu/"> </span>
              </a>
              <span id="/bufferhuan-chong-qu/" class="leancloud_visitors views-counter meta-info" title=""><i class="fa fa-leancloud remixicon"></i><span class="leancloud-visitors-count"></span></span>
              
            </div>
            <div class="info">
              <div class="tags ">
                
              </div>
              <h1 class="title ularge white bold">Buffer（缓冲区）</h1>
            </div>
          </div>
        </div>  

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <p>前言：</p>
<p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。</p>
<p>但在处理像TCP流或文件流时，必须使用到二进制数据。因此在NodeJS中，定义了一个Buffer类，该类用来创建一个专门存放二进制数据的缓存区。</p>
<p>在NodeJS中，Buffer类是随NodeJS内核一起发布的核心库。Buffer库为NodeJS带来了一种存储原始数据的方法，可以让NodeJS处理二进制数据，每当需要在NodeJS中处理I/O操作中移动的数据时，就有可能使用Buffer库。原始数据存储在Buffer类的实例中。一个Buffer类似于一个整数数据，但它对应于V8堆内存之外的一块原始内存。</p>
<blockquote>
<p>tips：在v6.0之前创建Buffer对象直接使用new Buffer()构造函数来创建对象实例，但是Buffer对内存的权限操作相比很大，可以直接捕获一些敏感信息，所以在v6.0以后，官方文档里面建议使用 Buffer.from() 接口去创建Buffer对象。</p>
</blockquote>
<h2 id="buffer-与字符编码">Buffer 与字符编码</h2>
<p>Buffer实例一般用于表示编码字符的序列，比如UTF-8 、UCS 、Base64 、或十六进制编码的数据。通过使用显试的字符编码，就可以在Buffer实例与普通的JavaScript字符串之间进行互相转换。</p>
<pre><code class="language-js">const buf = Buffer.from(&quot;Little Boy&quot;, &quot;ascii&quot;)

console.log(buf.toString(&quot;hex&quot;)) // 4c6974746c6520426f79
console.log(buf.toString(&quot;base64&quot;)) // TGl0dGxlIEJveQ==
</code></pre>
<p>Node.js 目前支持的字符编码包括：</p>
<ul>
<li>ascii - 仅支持 7 位 ASCII 数据。如果设置去掉高位的话，这种编码是非常快的。</li>
<li>ascii - 仅支持 7 位 ASCII 数据。如果设置去掉高位的话，这种编码是非常快的。</li>
<li>utf8 - 多字节编码的 Unicode 字符。许多网页和其他文档格式都使用 UTF-8 。</li>
<li>utf16le - 2 或 4 个字节，小字节序编码的 Unicode 字符。支持代理对（U+10000 至 U+10FFFF）。</li>
<li>ucs2 - utf16le 的别名。</li>
<li>base64 - Base64 编码。</li>
<li>latin1 - 一种把 Buffer 编码成一字节编码的字符串的方式。</li>
<li>binary - latin1 的别名。</li>
<li>hex - 将每个字节编码为两个十六进制字符。</li>
</ul>
<h2 id="创建-buffer-类">创建 Buffer 类</h2>
<ul>
<li>Buffer.alloc(size[, fill[, encoding]])： 返回一个指定大小的 Buffer 实例，如果没有设置 fill，则默认填满 0</li>
<li>Buffer.allocUnsafe(size)： 返回一个指定大小的 Buffer 实例，但是它不会被初始化，所以它可能包含敏感的数据</li>
<li>Buffer.allocUnsafeSlow(size)</li>
<li>Buffer.from(array)： 返回一个被 array 的值初始化的新的 Buffer 实例（传入的 array 的元素只能是数字，不然就会自动被 0 覆盖）</li>
<li>Buffer.from(arrayBuffer[, byteOffset[, length]])： 返回一个新建的与给定的 ArrayBuffer 共享同一内存的 Buffer。</li>
<li>Buffer.from(buffer)： 复制传入的 Buffer 实例的数据，并返回一个新的 Buffer 实例</li>
<li>Buffer.from(string[, encoding])： 返回一个被 string 的值初始化的新的 Buffer 实例</li>
</ul>
<pre><code class="language-js">// 创建一个长度为 10 且用0填充的Buffer
const buf1 = Buffer.alloc(10)

// 创建一个长度为10 且用0x1填充的Buffer
const buf2 = Buffer.alloc(10, 1)

// 创建一个长度为10 且未初始化的Buffer
// 这个方法调用 Buffer.alloc()更快
// 但返回的Buffer实例可能包含就数据
// 因此需要使用fill()或write()重写
const buf3 = Buffer.allocUnsafe(10)

// 创建一个包含[0x1, 0x2, 0x3] 的 Buffer。
const buf4 = Buffer.from([1, 2, 3])

// 创建一个包含 UTF-8字节[0x74, 0xc3, 0xa9, 0x73, 0x74] 的 Buffer。
const buf5 = Buffer.from(&quot;test&quot;)

// 创建一个包含Latin-1 字节 [0x74, 0xe9, 0x73, 0x74] 的 Buffer。
const buf6 = Buffer.from(&quot;test&quot;, &quot;latin1&quot;)
</code></pre>
<h2 id="写入缓冲区">写入缓冲区</h2>
<h3 id="语法">语法</h3>
<p>写入 Node 缓冲区的语法如下所示：</p>
<blockquote>
<p>buf.write(string[, offset[, length]][, encoding])</p>
</blockquote>
<h3 id="参数">参数</h3>
<ul>
<li>string - 写入缓冲区的字符串。</li>
<li>offset - 缓冲区开始写入的索引值，默认为 0 。</li>
<li>length - 写入的字节数，默认为 buffer.length</li>
<li>encoding - 使用的编码。默认为 'utf8' 。</li>
</ul>
<p>根据encoding的字符编码写入string到buf中的offet为位置，length参数是写入的字节数。如果buf没有足够的空间保存整个字符串，则只会写入string的一部分。</p>
<h3 id="实例">实例</h3>
<pre><code class="language-js">buf = Buffer.alloc(256);
len = buf.write(&quot;Little Boy&quot;);

console.log(&quot;写入字节数 : &quot;+  len);  // 写入字节数 : 10
</code></pre>
<h2 id="从缓冲区读取数据">从缓冲区读取数据</h2>
<h3 id="语法-2">语法</h3>
<blockquote>
<p>buf.toString([encoding[, start[, end]]])</p>
</blockquote>
<h3 id="参数-2">参数</h3>
<ul>
<li>
<p>encoding - 使用的编码。默认为 'utf8' 。</p>
</li>
<li>
<p>start - 指定开始读取的索引位置，默认为 0。</p>
</li>
<li>
<p>end - 结束位置，默认为缓冲区的末尾。</p>
</li>
</ul>
<h3 id="返回值">返回值</h3>
<p>解码缓冲区数据并使用指定的编码返回字符串。</p>
<h3 id="实例-2">实例</h3>
<pre><code class="language-js">buf = Buffer.alloc(26);
for (const i = 0 ; i &lt; 26 ; i++) {
  buf[i] = i + 97;
}

console.log( buf.toString('ascii'));       // 输出: abcdefghijklmnopqrstuvwxyz
console.log( buf.toString('ascii',0,5));   //使用 'ascii' 编码, 并输出: abcde
console.log( buf.toString('utf8',0,5));    // 使用 'utf8' 编码, 并输出: abcde
console.log( buf.toString(undefined,0,5)); // 使用默认的 'utf8' 编码, 并输出: abcdes
</code></pre>
<h2 id="将-buffer-转换为-json-对象">将 Buffer 转换为 JSON 对象</h2>
<h3 id="语法-3">语法</h3>
<p>将 Node Buffer 转换为 JSON 对象的函数语法格式如下：</p>
<blockquote>
<p>buf.toJSON()</p>
</blockquote>
<p>当字符串化一个 Buffer 实例时，JSON.stringify() 会隐式地调用该 toJSON()。</p>
<h3 id="返回值-2">返回值</h3>
<p>返回 JSON 对象。</p>
<h3 id="实例-3">实例</h3>
<pre><code class="language-js">const buf = Buffer.from([0x1, 0x2, 0x3, 0x4])
const json = JSON.stringify(buf)

// 输出: {&quot;type&quot;:&quot;Buffer&quot;,&quot;data&quot;:[1,2,3,4,5]}
console.log(json)

const copy = JSON.parse(json, (key, value) =&gt; {
  return value &amp;&amp; value.type === &quot;Buffer&quot; ? Buffer.from(value.data) : value
})

// 输出: &lt;Buffer 01 02 03 04 05&gt;
console.log(copy)
</code></pre>
<h2 id="缓冲区合并">缓冲区合并</h2>
<h3 id="语法-4">语法</h3>
<p>Node 缓冲区合并的语法如下所示：</p>
<blockquote>
<p>Buffer.concat(list[, totalLength])</p>
</blockquote>
<h3 id="参数-3">参数</h3>
<p>参数描述如下：</p>
<ul>
<li>list - 用于合并的 Buffer 对象数组列表。</li>
<li>totalLength - 指定合并后Buffer对象的总长度。</li>
</ul>
<h3 id="返回值-3">返回值</h3>
<p>返回一个多个成员合并的新 Buffer 对象。</p>
<h3 id="实例-4">实例</h3>
<pre><code class="language-js">const buf1 = Buffer.from(&quot;大前端&quot;)
const buf2 = Buffer.from(&quot;Little Boy&quot;)
const buffer3 = Buffer.concat([buf1, buf2])
console.log(&quot;buffer3 内容: &quot; + buffer3.toString()) // buffer3 内容: 大前端Little Boy
</code></pre>
<h2 id="缓冲区比较">缓冲区比较</h2>
<h3 id="语法-5">语法</h3>
<p>Node Buffer 比较的函数语法如下所示, 该方法在 Node.js v0.12.2 版本引入：</p>
<blockquote>
<p>buf.compare(otherBuffer);</p>
</blockquote>
<h3 id="参数-4">参数</h3>
<ul>
<li>otherBuffer - 与 buf 对象比较的另外一个 Buffer 对象。</li>
</ul>
<h3 id="返回值-4">返回值</h3>
<p>返回一个数字，表示 buf 在 otherBuffer 之前，之后或相同。</p>
<h3 id="实例-5">实例</h3>
<pre><code class="language-js">const buf1 = Buffer.from(&quot;ABC&quot;)
const buf2 = Buffer.from(&quot;DCE&quot;)

const result = buf1.compare(buf2)

if (result &lt; 0) {
  console.log(buf1 + &quot; 在 &quot; + buf2 + &quot;之前&quot;)
} else if (result == 0) {
  console.log(buf1 + &quot; 与 &quot; + buf2 + &quot;相同&quot;)
} else {
  console.log(buf1 + &quot; 在 &quot; + buf2 + &quot;之后&quot;)
}

// ABC 在 DCE之前
</code></pre>
<h2 id="拷贝缓冲区">拷贝缓冲区</h2>
<h3 id="语法-6">语法</h3>
<blockquote>
<p>buf.copy(targetBuffer[, targetStart[, sourceStart[, sourceEnd]]])</p>
</blockquote>
<h3 id="参数-5">参数</h3>
<ul>
<li>targetBuffer - 要拷贝的 Buffer 对象。</li>
<li>targetStart - 数字, 可选, 默认: 0</li>
<li>sourceStart - 数字, 可选, 默认: 0</li>
<li>sourceEnd - 数字, 可选, 默认: buffer.length</li>
</ul>
<h3 id="实例-6">实例</h3>
<pre><code class="language-js">const buf1 = Buffer.from('abcdefghijkl');
const buf2 = Buffer.from('RUNOOB');

//将 buf2 插入到 buf1 指定位置上
buf2.copy(buf1, 2);
console.log(buf1.toString()); // abRUNOOBijkl
</code></pre>
<h2 id="缓冲区裁切">缓冲区裁切</h2>
<h3 id="语法-7">语法</h3>
<blockquote>
<p>buf.slice([start[, end]])</p>
</blockquote>
<h3 id="参数-6">参数</h3>
<ul>
<li>start - 数字, 可选, 默认: 0</li>
<li>end - 数字, 可选, 默认: buffer.length</li>
</ul>
<h3 id="返回值-5">返回值</h3>
<p>返回一个新的缓冲区，它和旧缓冲区指向同一块内存，但是从索引 start 到 end 的位置剪切。</p>
<h3 id="实例-7">实例</h3>
<pre><code class="language-js">const buf1 = Buffer.from('Little Boy');
// 剪切缓冲区
const buf2 = buf1.slice(0,2);
console.log(&quot;buf2 content: &quot; + buf2.toString()); // buf2 content: Li
</code></pre>
<h2 id="缓冲区长度">缓冲区长度</h2>
<h3 id="语法-8">语法</h3>
<blockquote>
<p>buf.length;</p>
</blockquote>
<h3 id="返回值-6">返回值</h3>
<p>buf.length;</p>
<h3 id="实例-8">实例</h3>
<pre><code class="language-js">const buf = Buffer.from('Little Boy');
//  缓冲区长度
console.log(&quot;buf length: &quot; + buffer.length); // buf length 10
</code></pre>

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

            <section class="related section">
              
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
              <div id="comments" class="bg-white hosted ">
                <div class="clear"></div>
<script>
jQuery(document).ready(function($){
    $('.vemoji-btn').text('😀');
    $("#comments").on('click', 'span.vat',function(){
        $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
        $('textarea#veditor').focus();
    })
    if(window.location.hash){
        var checkExist = setInterval(function() {
            if ($(window.location.hash).length) {
                $('html, body').animate({scrollTop: $(window.location.hash).offset().top-200}, 600);
                clearInterval(checkExist);
            }
        }, 100);
    }
})
</script>

              </div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">最新文章</h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="/ssh-mi-yao-fang-shi-yuan-cheng-lian-jie-linux" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('/media/images/gridea.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-09-29">2020-09-29</time>
                      <h4 class="title usmall">
                        <a href="/ssh-mi-yao-fang-shi-yuan-cheng-lian-jie-linux">SSH密钥方式远程连接Linux</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="/linux-chang-jian-ming-ling" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('/media/images/gridea.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-09-29">2020-09-29</time>
                      <h4 class="title usmall">
                        <a href="/linux-chang-jian-ming-ling">Linux 常见命令</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="/linux-an-zhuang-docker" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('/media/images/gridea.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2020-09-29">2020-09-29</time>
                      <h4 class="title usmall">
                        <a href="/linux-an-zhuang-docker">Linux 安装 Docker</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">标签云</h4>
                  <div class="tagcloud">
                    
                      <a href="/mOE9vbkrU" class="ctag ctag-0 ctag-mOE9vbkrU" aria-label="">Linux</a>
                    
                      <a href="/b02rvhSHe" class="ctag ctag-1 ctag-b02rvhSHe" aria-label="">JavaScript</a>
                    
                      <a href="/A6Q75Twsp" class="ctag ctag-2 ctag-A6Q75Twsp" aria-label="">NodeJS</a>
                    
                      <a href="/daPyJFle1" class="ctag ctag-3 ctag-daPyJFle1" aria-label="">面试题</a>
                    
                      <a href="/-bPu6JFhz" class="ctag ctag-4 ctag--bPu6JFhz" aria-label="">QA</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">关于我</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="">LittleBoy-前端爱好者</a></h4>
                    <p class="founder">一位前端爱好者的大前端养成记</p>
                    <div class="social">
                      
                          
                            <a href="https://github.com/zhourengui" class="translate-effect" target="_blank"><i class="fa fa-github"></i></a>
                        
                      
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href=""><img src="/media/images/custom-footerLogo.png" alt=""></a>
        </div>
        <p class="published border-effect">
          ©2020 共 19 篇文章
          Author by <a href="javascript:void(0)">「LittleBoy」</a>
        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/valine/1.3.10/Valine.Pure.min.js"></script>
<script>
    new Valine({
        el: '#comments',
        appId: 'bEuEMACG0o7iNnryQQYgfLE2-gzGzoHsz' ,
        appKey: 'Xkv8kTC4SwEtYxpQs6EuyuSS',
        pageSize: 30,
        placeholder: '既然来了，那就留个痕迹吧~',
        visitor: true // 阅读量统计
    })
</script>
    

      
    <script src="/media/js/functions-post.js"></script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
